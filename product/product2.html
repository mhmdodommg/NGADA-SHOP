<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุนุฑุถ ุงูููุชุฌ</title>
    <link rel="stylesheet" href="css/product.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Beiruti:wght@200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
</head>
<body>
    
    <div class="navbar">
        <div class="menu">
            <a href="http://localhost:8080/%D9%85%D8%AA%D8%AC%D8%B1%20%D9%85%D8%AF%D9%8A%D9%86%D8%A9%20%D9%86%D9%82%D8%A7%D8%AF%D8%A9.html"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a>
            <a href="account.html"><i class="fas fa-user"></i> ุญุณุงุจู</a>
            <a href="about.html"><i class="fas fa-info-circle"></i> ุนูุง</a>
            <a href="http://localhost:8080/%D9%8A%D9%88%D9%85%20%D8%A7%D9%84%D9%85%D8%AA%D8%AC%D8%B1%20%D9%86%D9%82%D8%A7%D8%AF%D8%A9.html"><i class="fas fa-envelope"></i> ุชูุงุตู</a>
        </div>
    </div>   
   <!-- ๐ ุณูุฉ ุงููุดุชุฑูุงุช -->
    <div id="cart-popup" class="cart-popup">  
        <p id="empty-cart-message" style="color: red; font-weight: bold; display: none;"></p>  
        <h2>๐๏ธ ุณูุฉ ุงููุดุชุฑูุงุช</h2>  
        <ul id="cart-items"></ul>  
        <button onclick="clearCart()">ุฅูุฑุงุบ ุงูุณูุฉ</button>  
        <button onclick="toggleCartPopup()">ุฅุบูุงู</button>          
        <p><strong>ุงูุฅุฌูุงูู:</strong> <span id="total-price">0</span> ุฌููู</p>  
        <button onclick="checkout()">ุฅุชูุงู ุงูุทูุจ</button>  
    </div>  

    <div class="product">
        <a href="javascript:history.back()" class="back-button">ใ<br>ุนูุฏุฉ</a>
        <img src="img/product2.jpg" alt="ุตูุฑุฉ ุงูููุชุฌ" class="product-img">
        <div class="product-info">
            <h2>ุฃูููู ูกูก ุจุฑู ูุงูุณ</h2>
            <p class="price">ุงูุณุนุฑ: 22000 ุฌููู</p>
            <p class="description">ูุงุชู ุฃุจู ุงูุบูู ุนู ุงูุชุนุฑูู ุฌูุฏุฉ ูุฎุงูุฉ ุนุงููุฉ ูุงุตููุฉ ุ ูู ุชุจุญุซ ุนู ุงูุงูุงูุฉ ููุฏ ูุฌุฏุชูุง ุงุฐุง! ุฅูู ููุชู </p>
            <p>:ุงููููุฉ</p>
            <div class="quantity-selector" data-price="22000">
                <button class="minus">-</button>
                <input type="text" id="quantity" value="1" readonly>
                <button class="plus">+</button>   
            </div>       
            <p class="total-price">ุงูุฅุฌูุงูู: <span id="total">22000</span> ุฌููู</p>
            <button  class="buy-btn" data-name="ุชูููู ุงูููู ูกูก  ุจุฑู ูุงูุณ" data-price="22000" onclick="addToCart(this)" onclick="toggleCartPopup()">ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ</button>       
        </div>        

        <div class="product">
            <h1>ููู ุงูููุชุฌ</h1>
            <div class="stars" id="product2">
                <span class="star" data-rating="1">&#9733;</span>
                <span class="star" data-rating="2">&#9733;</span>
                <span class="star" data-rating="3">&#9733;</span>
                <span class="star" data-rating="4">&#9733;</span>
                <span class="star" data-rating="5">&#9733;</span>
            </div>
            <input type="text" class="re-com" id="username-product2" placeholder="ุงุณูู">
            <textarea id="comment-product2" class="re-com" placeholder="ุฃุถู ุชุนูููู ููุง..."></textarea>
            <button onclick="submitRating('product2')" class="ret-bt">ุฅุฑุณุงู ุงูุชูููู</button>
            <div class="previous-ratings">
                <h2>ุงูุชููููุงุช ุงูุณุงุจูุฉ</h2>
                <div id="ratings-list-product2"></div>
            </div>
        </div>

    </div>
    
<script>
    // ุชููุฆุฉ Firebase - ุงุณุชุจุฏู ูุฐู ุงูููู ูู ุฅุนุฏุงุฏุงุช ูุดุฑูุนู
    const firebaseConfig = {
        apiKey: "AIzaSyADxRfJY9-W1TZE-zWXc1zFeiHpidsXbug",
        authDomain: "coment-a7ac2.firebaseapp.com",
        databaseURL: "https://coment-a7ac2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "coment-a7ac2",
        storageBucket: "coment-a7ac2.appspot.com",
        messagingSenderId: "1088742650545",
        appId: "1:1088742650545:web:c66518ea620db96b46e890"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let currentRating = 0;

    // ุชุญููู ุงูุชููููุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
    function loadRatings(productId) {
        database.ref('ratings/' + productId).on('value', (snapshot) => {
            const ratings = snapshot.val() || {};
            const ratingsList = document.getElementById(`ratings-list-${productId}`);
            
            ratingsList.innerHTML = "";
            
            if (Object.keys(ratings).length === 0) {
                ratingsList.innerHTML = "<p>ูุง ุชูุฌุฏ ุชููููุงุช ููุฐุง ุงูููุชุฌ ุจุนุฏ.</p>";
            } else {
                Object.values(ratings).forEach(rating => {
                    const ratingItem = document.createElement('div');
                    ratingItem.classList.add('rating-item');
                    ratingItem.innerHTML = `
                        <strong>${rating.username}</strong>
                        <p>ุงูุชูููู: ${rating.rating} ูุฌูู</p>
                        <p>${rating.comment}</p>
                        <small>${new Date(rating.date).toLocaleString()}</small>
                    `;
                    ratingsList.appendChild(ratingItem);
                });
            }
        });
    }

    // ุฅุฑุณุงู ุงูุชูููู
    function submitRating(productId) {
        const username = document.getElementById(`username-${productId}`).value.trim();
        const comment = document.getElementById(`comment-${productId}`).value.trim();
        
        if (!username || !comment || currentRating === 0) {
            alert("ุงูุฑุฌุงุก ุฅููุงู ุฌููุน ุงูุญููู ูุงุฎุชูุงุฑ ุงูุชูููู!");
            return;
        }

        const newRating = {
            username,
            rating: currentRating,
            comment,
            date: new Date().toISOString()
        };

        database.ref('ratings/' + productId).push(newRating)
            .then(() => {
                // ูุณุญ ุงูุญููู ุจุนุฏ ุงูุฅุฑุณุงู ุงููุงุฌุญ
                document.getElementById(`username-${productId}`).value = "";
                document.getElementById(`comment-${productId}`).value = "";
                currentRating = 0;
                
                // ุชูููุฒ ุงููุฌูู ุจูุงุกู ุนูู ุงูุชูููู
                document.querySelectorAll(`#${productId} .star`).forEach(star => {
                    star.classList.remove('active');
                });

                showSuccessMessage(); // ุนุฑุถ ุงูุฑุณุงูุฉ ุจุนุฏ ุฅุฑุณุงู ุงูุชูููู ุจูุฌุงุญ
            })
            .catch(error => {
                console.error("Error saving rating:", error);
                alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุชูููู");
            });
    }

    // ุชูููุฒ ุงููุฌูู ุนูุฏ ุงูุถุบุท
    document.querySelectorAll('.star').forEach(star => {
        star.addEventListener('click', function () {
            const ratingValue = parseInt(star.getAttribute('data-rating'));
            currentRating = ratingValue; // ุญูุธ ุงูุชูููู ุงููุญุฏุฏ
            
            // ุชุญุฏูุซ ุงููุฌูู ุงููุนุฑูุถุฉ
            updateStars(ratingValue);
        });
    });

    // ุชูููุฒ ุงููุฌูู ุจูุงุกู ุนูู ุงูุชูููู
    function updateStars(ratingValue) {
        document.querySelectorAll('.star').forEach(star => {
            if (parseInt(star.getAttribute('data-rating')) <= ratingValue) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    // ุนุฑุถ ุฑุณุงูุฉ "ุชู ุญูุธ ุงูุชูููู ุจูุฌุงุญ"
    function showSuccessMessage() {
        const successMessage = document.getElementById("success-message");
        successMessage.classList.add("show");

        // ุฅุฎูุงุก ุงูุฑุณุงูุฉ ุจุนุฏ 3 ุซูุงูู
        setTimeout(() => {
            successMessage.classList.remove("show");
        }, 3000);
    }
</script>
    <div id="success-message" class="success-message">ุชู ุญูุธ ุงูุชูููู ุจูุฌุงุญ!</div>
    <script src="product.js"></script>
</body>
        </html>
