<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุนุฑุถ ุงูููุชุฌ</title>
    <link rel="stylesheet" href="css/product.css">
      <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Beiruti:wght@200..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">  
   <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
       <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
</head>
<body>
    
    <div class="navbar">
    <div class="menu">
        <a href=""><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a>
        <a href=""><i class="fas fa-user"></i> ุญุณุงุจู</a>
        <a href=""><i class="fas fa-info-circle"></i> ุนูุง</a>
        <a href=""><i class="fas fa-envelope"></i> ุชูุงุตู</a>
    </div>
</div>   
   <!-- ๐ ุณูุฉ ุงููุดุชุฑูุงุช -->
<div id="cart-popup" class="cart-popup">  
    <p id="empty-cart-message" style="color: red; font-weight: bold; display: none;"></p>  
    <h2>๐๏ธ ุณูุฉ ุงููุดุชุฑูุงุช</h2>  
    <ul id="cart-items"></ul>  
    <button onclick="clearCart()">ุฅูุฑุงุบ ุงูุณูุฉ</button>  
    <button onclick="toggleCartPopup()">ุฅุบูุงู</button>          
    <p><strong>ุงูุฅุฌูุงูู:</strong> <span id="total-price">0</span> ุฌููู</p>  
    <button onclick="checkout()">ุฅุชูุงู ุงูุทูุจ</button>  
</div>  

<!-- โ ูุงูุฐุฉ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุนููู (ุฎุงุฑุฌ ุงูุณูุฉ) -->
<div id="checkout-form" class="hidden">  
    <h3>ุฅุฏุฎุงู ุจูุงูุงุช ุงูุทูุจ</h3>  
    <input type="text" id="customer-name" placeholder="ุงูุงุณู" required>  
    <input type="tel" id="customer-phone" placeholder="ุฑูู ุงููุงุชู" required>  
    <input type="tel" id="customer-whatsapp" placeholder="ุฑูู ุงููุงุชุณุงุจ" required>  
    <input type="text" id="customer-address" placeholder="ุงูุนููุงู" required>  

    <!-- ๐ฆ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน -->
    <h4>ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน:</h4>
    <select id="payment-method" onchange="togglePaymentInfo()">
        <option value="cash">ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู</option>
        <option value="fawry">ููุฑู</option>
    </select>  

    <!-- ๐ณ ุจูุงูุงุช ุงูุฏูุน ุนุจุฑ ููุฑู -->
    <div id="fawry-info" class="hidden">
        <h4>ุชูุงุตูู ุงูุฏูุน ุนุจุฑ ููุฑู:</h4>
        <p><strong>๐น ุฑูู ุงูุญุณุงุจ:</strong> 123456789</p>
        <p><strong>๐น ุงุณู ุงููุณุชููุฏ:</strong> ููุชุจุฉ ุงูุณูุฏุงู</p>
        <p><strong>๐น ุจุนุฏ ุงูุฏูุนุ ุฃุฑุณู ุฅูุตุงู ุงูุชุญููู ุฅูู ูุงุชุณุงุจ: <span style="color: #ff5722;">0100000000</span></p>
    </div>
    <div id="overlay" class="hidden"></div>

<!-- ุงูููุงููุฉ ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู -->
<label for="terms-checkbox">
    <input type="checkbox" id="terms-checkbox"> ููุฏ ูุฑุฃุช ููุงููุช ุนูู  
</label>
<span onclick="openTermsPopup()" style="color: blue; cursor: pointer; text-decoration: underline;">
    ุงูุดุฑูุท ูุงูุฃุญูุงู
</span>

<!-- ูุงูุฐุฉ ุงูุดุฑูุท ูุงูุฃุญูุงู -->
<div id="terms-popup" class="hidden terms-popup">
    <div class="terms-content">
        <h3>ุงูุดุฑูุท ูุงูุฃุญูุงู</h3>
        <p>ุณูุงุณุฉ ุงูุทูุจุงุช ูุงูุฏูุน
ูุชู ุชุฃููุฏ ุงูุทูุจ ุจุนุฏ ุงุณุชููุงู ุนูููุฉ ุงูุฏูุน ุจุงููุงูู.
ุงูุฏูุน ูุชุงุญ ุนุจุฑ (ุงููุงุดุ ููุฑูุ ููุฏุงููู ูุงุด ).

ูู ุญุงู ูุฌูุฏ ุฎุทุฃ ูู ุงูุทูุจุ ูุฌุจ ุงูุชูุงุตู ูุนูุง ุฎูุงู 24 ุณุงุนุฉ ูู ุฅุชูุงู ุงูุนูููุฉ.

---
3. ุณูุงุณุฉ ุงูุดุญู ูุงูุชูุตูู

ูุชู ุชูุตูู ุงูุทูุจุงุช ุฏุงุฎู ููุงุฏุฉ ูุงูููุงุทู ุงููุฌุงูุฑุฉ ุฎูุงู (ุนุฏุฏ ุงูุฃูุงู ุงููุชููุน).

ุชูููุฉ ุงูุดุญู ูุชู ุชุญุฏูุฏูุง ุจูุงุกู ุนูู ุงูููุทูุฉ ูุทุฑููุฉ ุงูุชูุตูู.

ุงููุชุฌุฑ ุบูุฑ ูุณุคูู ุนู ุฃู ุชุฃุฎูุฑ ูุงุชุฌ ุนู ุดุฑูุงุช ุงูุดุญู ุฃู ุงูุธุฑูู ุงูุทุงุฑุฆุฉ.

---
4. ุณูุงุณุฉ ุงูุงุณุชุจุฏุงู ูุงูุงุณุชุฑุฌุงุน

ูุง ููุณูุญ ุจุงุณุชุฑุฌุงุน ุงูููุชุฌุงุช ุฅูุง ูู ุญุงูุฉ ูุฌูุฏ ุนูุจ ูุตูุนู ุฃู ุฎุทุฃ ูู ุงูุทูุจ.

ูุฌุจ ุงูุฅุจูุงุบ ุนู ุงููุดููุฉ ุฎูุงู (ุนุฏุฏ ุงูุฃูุงูุ ูุซู 48 ุณุงุนุฉ) ูู ุงุณุชูุงู ุงูุทูุจ.

ูุง ูููุจู ุงุณุชุฑุฌุงุน ุงูููุชุฌุงุช ุงูุชู ุชู ุงุณุชุฎุฏุงููุง ุฃู ูุชุญูุงุ ุจุงุณุชุซูุงุก ุงูุนููุจ ุงููุตูุนูุฉ.

ูุชุญูู ุงูุนููู ุชูุงููู ุงูุดุญู ุนูุฏ ุงูุงุณุชุจุฏุงู ุฃู ุงูุงุณุชุฑุฌุงุนุ ูุง ูู ููู ุงูุฎุทุฃ ูู ุงููุชุฌุฑ.

---
5. ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุญูุงูุฉ ุงูุจูุงูุงุช

ููุชุฒู ุจุญูุงูุฉ ุจูุงูุงุช ุงูุนููุงุก ูุนุฏู ูุดุงุฑูุชูุง ูุน ุฃู ุทุฑู ุซุงูุซ ุฏูู ุฅุฐู ูุณุจู.

ูุชู ุงุณุชุฎุฏุงู ุงููุนูููุงุช ุงูุดุฎุตูุฉ ููุท ููุนุงูุฌุฉ ุงูุทูุจุงุช ูุงูุชูุงุตู ูุน ุงูุนููุงุก.

---
6. ุญููู ุงููุชุฌุฑ

ูุญุชูุธ ุงููุชุฌุฑ ุจุงูุญู ูู ุชุนุฏูู ุงูุฃุณุนุงุฑ ุฃู ุงูุณูุงุณุงุช ุฏูู ุฅุดุนุงุฑ ูุณุจู.

ูุญู ูููุชุฌุฑ ุฑูุถ ุฃู ุฅูุบุงุก ุฃู ุทูุจ ูู ุญุงู ุงูุงุดุชุจุงู ูู ุงุญุชูุงู ุฃู ุณูุก ุงุณุชุฎุฏุงู ููุฎุฏูุฉ.

ูููุน ุงุณุชุฎุฏุงู ุฃู ูุญุชูู ูู ุงููุชุฌุฑ (ุตูุฑุ ูุตูุตุ ุชุตุงููู) ุฏูู ุฅุฐู ูุณุจู.
---
7. ุงูุชูุงุตู ูุงูุฏุนู
ูููู ุงูุชูุงุตู ูุนูุง ุนุจุฑ (ุงุฐูุฑ ุทุฑู ุงูุชูุงุตู ูุซู ูุงุชุณุงุจุ ููุณุจููุ ุฑูู ุงููุงุชู).
ุณุงุนุงุช ุงูุนูู ุงูุฑุณููุฉ: (ุญุฏุฏ ุงูุฃููุงุช ูุงูุฃูุงู ุงูุชู ูุชู ูููุง ุงูุฑุฏ ุนูู ุงูุนููุงุก).
---

ุชูุจูู ูุงู ููุนููุงุก ุจุดุฃู ุงูุชูุงุนุจ ุจุงูุทูุจุงุช

ูุญุฑุต ูู ูุชุฌุฑ ูุฏููุฉ ููุงุฏุฉ ุนูู ุชูุฏูู ุฃูุถู ุฎุฏูุฉ ููููุฉ ูุนููุงุฆูุงุ ููุนูู ุจุฌุฏ ูุถูุงู ูุตูู ุงูุทูุจุงุช ุจุณุฑุนุฉ ูุฏูุฉ. ููููู ุงูู ูู ุญุงู ุญุตูู ุงู ุดุฆ ูู ุงูุงุชู:

ุชูุฏูู ุทูุจุงุช ููููุฉ ูุนุฏู ุงุณุชูุงููุง.

ุฅูุบุงุก ุงูุทูุจุงุช ุงููุชูุฑุฑ ุจุฏูู ุณุจุจ ูููุน.

ูุญุงููุฉ ุงุณุชุบูุงู ุณูุงุณุงุช ุงูุงุณุชุจุฏุงู ูุงูุงุณุชุฑุฌุงุน ุจุทุฑู ุบูุฑ ูุดุฑูุนุฉ.
 ูุฅููุง ุณูุชุฎุฐ ุงูุฅุฌุฑุงุกุงุช ุงูููุงุณุจุฉุ ูุงูุชู ูุฏ ุชุดูู:
 
ุญุธุฑ ุงูุนููู ูู ุงูุทูุจ ูุณุชูุจูุงู.

ุฑูุถ ุชูููุฐ ุงูุทูุจุงุช ุงููุดุจููุฉ.

ุงูุฅุจูุงุบ ุนู ุฃู ูุญุงููุงุช ุงุญุชูุงููุฉ.

ูุญู ูุซู ุจุนููุงุฆูุง ุงููุฑุงู ูููุฏูุฑ ุชุนุงูููู ุงูุฌุงุฏ ูุนูุงุ ูุฐุง ูุฃูู ุงูุงูุชุฒุงู ุจุงูุดูุงููุฉ ูุงููุตุฏุงููุฉ ูุถูุงู ุงุณุชูุฑุงุฑูุฉ ุงูุฎุฏูุฉ ุจุฃูุถู ุดูู ูููู.
ุดูุฑุงู ูุชููููู ูุชุนุงูููู .</p>
        <button onclick="closeTermsPopup()">ุฅุบูุงู</button>
    </div>
</div>
    <button onclick="submitOrder()">ุฅุฑุณุงู ุงูุทูุจ</button>  
    <button onclick="closeCheckout()">ุฅุบูุงู</button>  
</div>
  <!-- ุฒุฑ ุณูุฉ ุงููุดุชุฑูุงุช -->    
<button class="cart-btn" onclick="toggleCartPopup()">  
    ๐ <span id="cart-count">0</span>  
</button>   
    <div class="product">
           <a href="javascript:history.back()" class="back-button">ใ<br>ุนูุฏุฉ</a>
        <img src="img/product1.jpg" alt="ุตูุฑุฉ ุงูููุชุฌ" class="product-img">
        <div class="product-info">
            <h2>ุดุจุดุจ ุจูุชู</h2>
            <p class="price">ุงูุณุนุฑ: 100 ุฌููู</p>
            <p class="description">ุดุจุดุจ ุจูุชู ุฌููู ูุงููู ุจุฎุงูุงุช ููุชุงุฒุฉ ููุชููุฉ ุจุงููุงู ุฌูููุฉ ูุฑุงุฆุนุฉ ุชุฏูู ุทูููุง </p>
                  <p>:ุงููููุฉ</p>
   <div class="quantity-selector" data-price="100">
    <button class="minus">-</button>
    <input type="text" id="quantity" value="1" readonly>
    <button class="plus">+</button>   
</div>       
<p class="total-price">ุงูุฅุฌูุงูู: <span id="total">100</span> ุฌููู</p>
  <button  class="buy-btn" data-name="ุดุจุดุจ ุจูุชู" data-price="100" onclick="addToCart(this)"onclick="toggleCartPopup()" >ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ</button>       
    </div>               
<div class="product" id="product1">
    <h1>ููู ุงูููุชุฌ</h1>
    <div class="stars" id="stars-product1">
        <span class="star" data-rating="1">&#9733;</span>
        <span class="star" data-rating="2">&#9733;</span>
        <span class="star" data-rating="3">&#9733;</span>
        <span class="star" data-rating="4">&#9733;</span>
        <span class="star" data-rating="5">&#9733;</span>
    </div>
    <input type="text" class="re-com" id="username-product1" placeholder="ุงุณูู">
    <textarea id="comment-product1" class="re-com" placeholder="ุฃุถู ุชุนูููู ููุง..."></textarea>
    <button onclick="submitRating('product1')" class="ret-bt">ุฅุฑุณุงู ุงูุชูููู</button>
    <div class="error-message" id="error-message-product1"></div>
    <div id="success-message-product1" class="success-message">ุชู ุญูุธ ุงูุชูููู ุจูุฌุงุญ!</div>
    <div class="previous-ratings">
        <p id="average-rating-product1" class="average-rating">ูุชูุณุท ุงูุชูููู: ุฌุงุฑู ุงูุญุณุงุจ...</p>
        <h2>ุงูุชููููุงุช ุงูุณุงุจูุฉ</h2>
        <div id="ratings-list-product1"></div>        
        <div id="rating-stats-product1" class="rating-stats"></div>
    </div>
</div>
<script>
  // ุชููุฆุฉ Firebase
const firebaseConfig = {
    apiKey: "AIzaSyADxRfJY9-W1TZE-zWXc1zFeiHpidsXbug",
    authDomain: "coment-a7ac2.firebaseapp.com",
    databaseURL: "https://coment-a7ac2-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "coment-a7ac2",
    storageBucket: "coment-a7ac2.appspot.com",
    messagingSenderId: "1088742650545",
    appId: "1:1088742650545:web:c66518ea620db96b46e890"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let currentRating = 0;

// ุชุญููู ุงูุชููููุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ ููู ููุชุฌ
window.onload = function() {
    loadRatings('product1');
    loadRatings('product2');
};

// ูุธููุฉ ุงูุฅุจูุงุบ
function reportRating(productId, ratingId) {
    const reportsRef = database.ref(`reports/${productId}/${ratingId}`);
    reportsRef.push({
        date: new Date().toISOString(),
        reason: "ุชู ุงูุฅุจูุงุบ ูู ูุจู ุงููุณุชุฎุฏู"
    });
    alert("ุชู ุงูุฅุจูุงุบ ุนู ุงูุชุนูููุ ุดูุฑูุง ูู.");
}

// ุชุญููู ุงูุชููููุงุช ููู ููุชุฌ
function loadRatings(productId) {
    database.ref('ratings/' + productId).on('value', (snapshot) => {
        const ratings = snapshot.val() || {};
        const ratingsList = document.getElementById(`ratings-list-${productId}`);
        const statsContainer = document.getElementById(`rating-stats-${productId}`);
        
        ratingsList.innerHTML = "";
        statsContainer.innerHTML = "";

        let totalRating = 0;
        let count = 0;
        let starCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

        if (Object.keys(ratings).length === 0) {
            ratingsList.innerHTML = "<p>ูุง ุชูุฌุฏ ุชููููุงุช ููุฐุง ุงูููุชุฌ ุจุนุฏ.</p>";
        } else {
            Object.values(ratings).forEach(rating => {
                totalRating += rating.rating;
                count++;
                starCounts[rating.rating]++;

                const ratingItem = document.createElement('div');
                ratingItem.classList.add('rating-item');
                ratingItem.innerHTML = `
                    <strong>${rating.username}</strong>
                    <p>ุงูุชูููู: ${generateStars(rating.rating)}</p>
                    <p>${rating.comment}</p>
                    <small>${new Date(rating.date).toLocaleString()}</small>

                    <div class="useful-rating">
                        <p>ูู ูุงู ูุฐุง ุงูุชูููู ูููุฏูุงุ</p>
                        <button class="useful-btn" onclick="voteHelpful(true, '${rating.username}', '${productId}')">๐</button>
                        <button class="useful-btn" onclick="voteHelpful(false, '${rating.username}', '${productId}')">๐</button>
                        <span id="helpful-count-${rating.username}">ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุฐูู ูุฌุฏูุง ุงูุชูููู ูููุฏูุง: 0</span>
                        <span id="not-helpful-count-${rating.username}">ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุฐูู ูู ูุฌุฏูุง ุงูุชูููู ูููุฏูุง: 0</span>
                    </div>
                    <button class="report-btn" onclick="reportRating('${productId}', '${rating.username}')">ุฅุจูุงุบ ุนู ุงูุชุนููู</button>
                `;
                ratingsList.appendChild(ratingItem);
            });
        }

        const average = count > 0 ? (totalRating / count).toFixed(1) : 0;
        const averageContainer = document.getElementById(`average-rating-${productId}`);
        if (averageContainer) {
            averageContainer.innerHTML = `ูุชูุณุท ุงูุชูููู: ${generateStars(Math.round(average))} (${average})`;
        }

        let statsHTML = "<h3>ุฅุญุตุงุฆูุงุช ุงูุชูููู:</h3>";
        for (let i = 5; i >= 1; i--) {
            statsHTML += `<p>${generateStars(i)}: ${starCounts[i]} ุชูููู</p>`;
        }
        statsContainer.innerHTML = statsHTML;
    });
}

// ุฏุงูุฉ ููุชุตููุช ุนูู ุงูุชูููู
async function voteHelpful(isHelpful, username, reviewId) {
    try {
        const userVoteRef = database.ref(`helpfulVotes/${reviewId}/${username}`);
        
        // ุงูุชุญูู ูู ูุฌูุฏ ุชุตููุช ุณุงุจู ูู Firebase
        const snapshot = await userVoteRef.once('value');
        
        if (snapshot.exists()) {
            alert("ููุฏ ููุช ุจุงูุชุตููุช ุจุงููุนู ุนูู ูุฐุง ุงูุชูููู.");
            return;
        }

        // ุชุฎุฒูู ุงูุชุตููุช ุงูุฌุฏูุฏ
        await userVoteRef.set({
            helpful: isHelpful,
            date: new Date().toISOString()
        });

        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        updateHelpfulStats(reviewId);
        
        // ุชุฎุฒูู ูู localStorage ูุชุฌูุจ ุฅุนุงุฏุฉ ุงูุชุตููุช ูู ููุณ ุงูุฌูุณุฉ
        localStorage.setItem(`voted_${reviewId}_${username}`, true);
        
    } catch (error) {
        console.error("Error in voteHelpful:", error);
        alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุณุฌูู ุชุตููุชู.");
    }
}

// ุฏุงูุฉ ูุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช (ููุง ูู ูู ุงูุญู ุงูุณุงุจู)
function updateHelpfulStats(reviewId) {
    const reviewRef = database.ref(`helpfulVotes/${reviewId}`);
    
    reviewRef.on('value', (snapshot) => {
        let helpfulCount = 0;
        let notHelpfulCount = 0;
        
        const votes = snapshot.val();
        if (votes) {
            Object.values(votes).forEach(vote => {
                if (vote.helpful) {
                    helpfulCount++;
                } else {
                    notHelpfulCount++;
                }
            });
        }

        // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
        const reviewElement = document.querySelector(`[data-review-id="${reviewId}"]`);
        if (reviewElement) {
            reviewElement.querySelector('.helpful-count').textContent = 
                `ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุฐูู ูุฌุฏูุง ุงูุชูููู ูููุฏูุง: ${helpfulCount}`;
            reviewElement.querySelector('.not-helpful-count').textContent = 
                `ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุฐูู ูู ูุฌุฏูุง ุงูุชูููู ูููุฏูุง: ${notHelpfulCount}`;
        }
    });
}

// ุนูุฏ ุชุญููู ุงูุตูุญุฉุ ูุชุญูู ูู ุงูุชุตููุชุงุช ุงูุณุงุจูุฉ
async function checkExistingVotes() {
    const allReviews = document.querySelectorAll('[data-review-id]');
    const currentUser = getCurrentUser(); // ูุฌุจ ุงุณุชุจุฏุงููุง ุจูุธููุฉ ุฌูุจ ุงููุณุชุฎุฏู ุงูุญุงูู
    
    for (const review of allReviews) {
        const reviewId = review.getAttribute('data-review-id');
        const userVoteRef = database.ref(`helpfulVotes/${reviewId}/${currentUser}`);
        
        const snapshot = await userVoteRef.once('value');
        if (snapshot.exists()) {
            localStorage.setItem(`voted_${reviewId}_${currentUser}`, true);
        }
    }
}

// ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
window.addEventListener('DOMContentLoaded', () => {
    initializeHelpfulVotes();
    checkExistingVotes();
});
// ุฅุฑุณุงู ุงูุชูููู
function submitRating(productId) {
    const username = document.getElementById(`username-${productId}`).value.trim();
    const comment = document.getElementById(`comment-${productId}`).value.trim();
    
    if (!username || !comment || currentRating === 0) {
        const errorBox = document.getElementById(`error-message-${productId}`);
        errorBox.textContent = "ุงูุฑุฌุงุก ุฅููุงู ุฌููุน ุงูุญููู ูุงุฎุชูุงุฑ ุงูุชูููู!";
        errorBox.classList.add("show");

        setTimeout(() => {
            errorBox.classList.remove("show");
        }, 3000);
        return;
    }

    if (localStorage.getItem(`rated_${username}_${productId}`)) {
        alert("ููุฏ ููุช ุจุชูููู ูุฐุง ุงูููุชุฌ ุจุงููุนู.");
        return;
    }

    const newRating = {
        username,
        rating: currentRating,
        comment,
        date: new Date().toISOString()
    };

    database.ref('ratings/' + productId).push(newRating)
        .then(() => {
            document.getElementById(`username-${productId}`).value = "";
            document.getElementById(`comment-${productId}`).value = "";
            currentRating = 0;

            document.querySelectorAll(`#${productId} .star`).forEach(star => {
                star.classList.remove('active');
            });

            showSuccessMessage(productId);
            loadRatings(productId);
            localStorage.setItem(`rated_${username}_${productId}`, true); // ุชุฎุฒูู ุฃู ุงููุณุชุฎุฏู ูุฏ ููู
        })
        .catch(error => {
            console.error("Error saving rating:", error);
            alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุชูููู");
        });
}

// ุชูููุฒ ุงููุฌูู ุนูุฏ ุงูุถุบุท
document.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', function () {
        const ratingValue = parseInt(star.getAttribute('data-rating'));
        currentRating = ratingValue;
        
        updateStars(ratingValue);
    });
});

function updateStars(ratingValue) {
    document.querySelectorAll('.star').forEach(star => {
        if (parseInt(star.getAttribute('data-rating')) <= ratingValue) {
            star.classList.add('active');
        } else {
            star.classList.remove('active');
        }
    });
}

function showSuccessMessage(productId) {
    const successMessage = document.getElementById(`success-message-${productId}`);
    successMessage.classList.add("show");

    setTimeout(() => {
        successMessage.classList.remove("show");
    }, 3000);
}

function generateStars(rating) {
    let stars = "";
    for (let i = 1; i <= 5; i++) {
        stars += i <= rating ? `<span class="star-icon">&#9733;</span>` : `<span class="star-icon">&#9734;</span>`;
    }
    return stars;
}
</script>
    <script src="product.js"></script>
</body>
</html>
