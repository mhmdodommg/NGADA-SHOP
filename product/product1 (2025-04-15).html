<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</title>
    <link rel="stylesheet" href="css/product.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Beiruti:wght@200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- ØªØ­Ù…ÙŠÙ„ Firebase Ø¨Ø´ÙƒÙ„ Ù…ØªØ£Ø®Ø± -->
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body>
    
    <div class="navbar">
        <div class="menu">
            <a href="http://localhost:8080/ngada%20shop/index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href=""><i class="fas fa-user"></i> Ø­Ø³Ø§Ø¨ÙŠ</a>
            <a href=""><i class="fas fa-info-circle"></i> Ø¹Ù†Ø§</a>
            <a href=""><i class="fas fa-envelope"></i> ØªÙˆØ§ØµÙ„</a>
        </div>
    </div>   
    
    <!-- ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
    <div id="cart-popup" class="cart-popup hidden">  
        <p id="empty-cart-message" style="color: red; font-weight: bold; display: none;"></p>  
        <h2>ğŸ›ï¸ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>  
        <ul id="cart-items"></ul>  
        <button onclick="confirmClearCart()">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>  
        <button onclick="toggleCartPopup()">Ø¥ØºÙ„Ø§Ù‚</button>          
        <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> <span id="total-price">0</span> Ø¬Ù†ÙŠÙ‡</p>  
        <button onclick="checkout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>  
    </div>  

    <!-- âœ… Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div id="checkout-form" class="hidden checkout-form">  
        <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>  
        <input type="text" id="customer-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>  
        <input type="tel" id="customer-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required pattern="[0-9]{10,15}">  
        <input type="tel" id="customer-whatsapp" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" required pattern="[0-9]{10,15}">  
        <textarea id="customer-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" required rows="3"></textarea>  

        <!-- ğŸ¦ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
        <h4>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</h4>
        <select id="payment-method" onchange="togglePaymentInfo()">
            <option value="cash">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
            <option value="fawry">ÙÙˆØ±ÙŠ</option>
        </select>  

        <!-- ğŸ’³ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ±ÙŠ -->
        <div id="fawry-info" class="hidden">
            <h4>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ±ÙŠ:</h4>
            <p><strong>ğŸ”¹ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> 123456789</p>
            <p><strong>ğŸ”¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</strong> Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</p>
            <p><strong>ğŸ”¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ØŒ Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨: <span style="color: #004d01;">0100000000</span></p>
        </div>
        <!-- Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… -->
        <div class="terms-agreement">
            <label for="terms-checkbox">
                <input type="checkbox" id="terms-checkbox" required> 
                Ù„Ù‚Ø¯ Ù‚Ø±Ø£Øª ÙˆÙˆØ§ÙÙ‚Øª Ø¹Ù„Ù‰  
                <span onclick="openTermsPopup()" style="color: blue; cursor: pointer; text-decoration: underline;">
                    Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
                </span>
            </label>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
        <div class="checkout-buttons">
            <button onclick="submitOrder()" class="sub-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>  
            <button onclick="closeCheckout()" class="cancel-btn">Ø¥ØºÙ„Ø§Ù‚</button>  
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… -->
    <div id="terms-popup" class="hidden terms-popup">
        <div class="terms-content">
            <h3>Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</h3>
            <p>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¯ÙØ¹
ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
Ø§Ù„Ø¯ÙØ¹ Ù…ØªØ§Ø­ Ø¹Ø¨Ø± (Ø§Ù„ÙƒØ§Ø´ØŒ ÙÙˆØ±ÙŠØŒ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ ).

ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ØŒ ÙŠØ¬Ø¨ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.

---
3. Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªÙˆØµÙŠÙ„

ÙŠØªÙ… ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¯Ø§Ø®Ù„ Ù†Ù‚Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø© Ø®Ù„Ø§Ù„ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹).

ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„.

Ø§Ù„Ù…ØªØ¬Ø± ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø£ÙŠ ØªØ£Ø®ÙŠØ± Ù†Ø§ØªØ¬ Ø¹Ù† Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø´Ø­Ù† Ø£Ùˆ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø·Ø§Ø±Ø¦Ø©.

---
4. Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹

Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ø§ ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø¹ÙŠØ¨ Ù…ØµÙ†Ø¹ÙŠ Ø£Ùˆ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨.

ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø®Ù„Ø§Ù„ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…ØŒ Ù…Ø«Ù„ 48 Ø³Ø§Ø¹Ø©) Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.

Ù„Ø§ ÙŠÙÙ‚Ø¨Ù„ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø£Ùˆ ÙØªØ­Ù‡Ø§ØŒ Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø¹ÙŠÙˆØ¨ Ø§Ù„Ù…ØµÙ†Ø¹ÙŠØ©.

ÙŠØªØ­Ù…Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ø­Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ØŒ Ù…Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±.

---
5. Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

Ù†Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø« Ø¯ÙˆÙ† Ø¥Ø°Ù† Ù…Ø³Ø¨Ù‚.

ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙ‚Ø· Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.

---
6. Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ØªØ¬Ø±

ÙŠØ­ØªÙØ¸ Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø§Ù„Ø­Ù‚ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø± Ù…Ø³Ø¨Ù‚.

ÙŠØ­Ù‚ Ù„Ù„Ù…ØªØ¬Ø± Ø±ÙØ¶ Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ Ø·Ù„Ø¨ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø§Ø´ØªØ¨Ø§Ù‡ ÙÙŠ Ø§Ø­ØªÙŠØ§Ù„ Ø£Ùˆ Ø³ÙˆØ¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù„Ø®Ø¯Ù…Ø©.

ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø± (ØµÙˆØ±ØŒ Ù†ØµÙˆØµØŒ ØªØµØ§Ù…ÙŠÙ…) Ø¯ÙˆÙ† Ø¥Ø°Ù† Ù…Ø³Ø¨Ù‚.
---
7. Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù…
ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± (Ø§Ø°ÙƒØ± Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø«Ù„ ÙˆØ§ØªØ³Ø§Ø¨ØŒ ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ).
Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ©: (Ø­Ø¯Ø¯ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ÙˆØ§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ ÙŠØªÙ… ÙÙŠÙ‡Ø§ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡).
---

ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù… Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø´Ø£Ù† Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§Øª

Ù†Ø­Ø±Øµ ÙÙŠ Ù…ØªØ¬Ø± Ù…Ø¯ÙŠÙ†Ø© Ù†Ù‚Ø§Ø¯Ø© Ø¹Ù„Ù‰ ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø®Ø¯Ù…Ø© Ù…Ù…ÙƒÙ†Ø© Ù„Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§ØŒ ÙˆÙ†Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø³Ø±Ø¹Ø© ÙˆØ¯Ù‚Ø©. ÙˆÙ†Ù†ÙˆÙ‡ Ø§Ù†Ù‡ ÙÙŠ Ø­Ø§Ù„ Ø­ØµÙˆÙ„ Ø§ÙŠ Ø´Ø¦ Ù…Ù† Ø§Ù„Ø§ØªÙŠ:

ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ÙˆØ¹Ø¯Ù… Ø§Ø³ØªÙ„Ø§Ù…Ù‡Ø§.

Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø± Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨ Ù…Ù‚Ù†Ø¹.

Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØºÙ„Ø§Ù„ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨Ø·Ø±Ù‚ ØºÙŠØ± Ù…Ø´Ø±ÙˆØ¹Ø©.
 ÙØ¥Ù†Ù†Ø§ Ø³Ù†ØªØ®Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŒ ÙˆØ§Ù„ØªÙŠ Ù‚Ø¯ ØªØ´Ù…Ù„:
 
Ø­Ø¸Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹.

Ø±ÙØ¶ ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©.

Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ø­ØªÙŠØ§Ù„ÙŠØ©.

Ù†Ø­Ù† Ù†Ø«Ù‚ Ø¨Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§ Ø§Ù„ÙƒØ±Ø§Ù… ÙˆÙ†Ù‚Ø¯Ù‘Ø± ØªØ¹Ø§Ù…Ù„Ù‡Ù… Ø§Ù„Ø¬Ø§Ø¯ Ù…Ø¹Ù†Ø§ØŒ Ù„Ø°Ø§ Ù†Ø£Ù…Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ø£ÙØ¶Ù„ Ø´ÙƒÙ„ Ù…Ù…ÙƒÙ†.
Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙÙ‡Ù…ÙƒÙ… ÙˆØªØ¹Ø§ÙˆÙ†ÙƒÙ… .</p>
            <button onclick="closeTermsPopup()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <!-- Ø²Ø± Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->    
    <button class="cart-btn" onclick="toggleCartPopup()">  
        ğŸ›’ <span id="cart-count">0</span>  
    </button>   
    
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div class="product-container">
        <a href="javascript:history.back()" class="back-button">ã€Š<br>Ø¹ÙˆØ¯Ø©</a>
        <img src="img/product1.jpg" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" class="product-img">
        <div class="product-info">
            <h2>Ø´Ø¨Ø´Ø¨ Ø¨ÙŠØªÙŠ</h2>
            <p class="price">Ø§Ù„Ø³Ø¹Ø±: 100 Ø¬Ù†ÙŠÙ‡</p>
            <p class="description">Ø´Ø¨Ø´Ø¨ Ø¨ÙŠØªÙŠ Ø¬Ù…ÙŠÙ„ ÙˆØ§Ù†ÙŠÙ‚ Ø¨Ø®Ø§Ù…Ø§Øª Ù…Ù…ØªØ§Ø²Ø© ÙˆÙ…ØªÙŠÙ†Ø© Ø¨Ø§Ù„ÙˆØ§Ù† Ø¬Ù…ÙŠÙ„Ø© ÙˆØ±Ø§Ø¦Ø¹Ø© ØªØ¯ÙˆÙ… Ø·ÙˆÙŠÙ„Ø§ </p>
            <p>:Ø§Ù„ÙƒÙ…ÙŠØ©</p>
            <div class="quantity-selector" data-price="100">
                <button class="minus">-</button>
                <input type="text" id="quantity" value="1" readonly>
                <button class="plus">+</button>   
            </div>       
            <p class="total-price">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">100</span> Ø¬Ù†ÙŠÙ‡</p>
            <button class="buy-btn" data-name="Ø´Ø¨Ø´Ø¨ Ø¨ÙŠØªÙŠ" data-price="100" onclick="addToCartAndShow(this)">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>       
        </div>               
        
        <!-- ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
        <div class="product-ratings" id="product1">
            <h1>Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬</h1>
            <div class="stars" id="stars-product1">
                <span class="star" data-rating="1">&#9733;</span>
                <span class="star" data-rating="2">&#9733;</span>
                <span class="star" data-rating="3">&#9733;</span>
                <span class="star" data-rating="4">&#9733;</span>
                <span class="star" data-rating="5">&#9733;</span>
            </div>
            <input type="text" class="re-com" id="username-product1" placeholder="Ø§Ø³Ù…Ùƒ">
            <textarea id="comment-product1" class="re-com" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
            <button onclick="submitRating('product1')" class="ret-bt">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
            
            <div id="error-message-product1" class="error-message" style="display:none;">
                Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆØªØ¹Ù„ÙŠÙ‚
            </div>
            
            <div id="success-message-product1" class="success-message" style="display:none;">
                ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!
            </div>
            
            <h2>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
            <div id="ratings-list-product1" class="ratings-list"></div>
        </div>
    </div>

    <!-- Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ¹ØªÙŠÙ… -->
    <div id="overlay" class="overlay hidden"></div>

    <script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyADxRfJY9-W1TZE-zWXc1zFeiHpidsXbug",
        authDomain: "coment-a7ac2.firebaseapp.com",
        databaseURL: "https://coment-a7ac2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "coment-a7ac2",
        storageBucket: "coment-a7ac2.appspot.com",
        messagingSenderId: "1088742650545",
        appId: "1:1088742650545:web:c66518ea620db96b46e890"
    };

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let database;
    let auth;
    let currentRating = 0;
    const ADMIN_PASSWORD = "admin123"; // ÙŠØ¬Ø¨ Ù†Ù‚Ù„ Ù‡Ø°Ø§ Ù„Ù„Ø®Ù„ÙÙŠØ© Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©
    let isVoting = false;

    // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = async function() {
        // ØªÙ‡ÙŠØ¦Ø© ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬
        initQuantitySelector();
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        await initFirebase();
        
        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
        initStars('product1');
        loadRatings('product1');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
        checkAdminAccess();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù…Ù† localStorage Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
        loadCart();
    };

    // ============== Ù†Ø¸Ø§Ù… ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬ ============== //
    function initQuantitySelector() {
        const minusBtn = document.querySelector('.quantity-selector .minus');
        const plusBtn = document.querySelector('.quantity-selector .plus');
        const quantityInput = document.querySelector('.quantity-selector #quantity');
        const price = document.querySelector('.quantity-selector').dataset.price;
        const totalElement = document.getElementById('total');
        
        minusBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
                updateTotalPrice();
            }
        });
        
        plusBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            quantityInput.value = currentValue + 1;
            updateTotalPrice();
        });
        
        function updateTotalPrice() {
            const quantity = parseInt(quantityInput.value);
            const total = quantity * parseInt(price);
            totalElement.textContent = total;
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Firebase ============== //
    async function initFirebase() {
        try {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Firebase ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            if (typeof firebase === 'undefined') {
                throw new Error("Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
            }
            
            const app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            auth = firebase.auth();
            console.log("Firebase initialized successfully");
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            await auth.signInAnonymously();
            console.log("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'error');
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø¬ÙˆÙ… ============== //
    function initStars(productId) {
        const stars = document.querySelectorAll(`#stars-${productId} .star`);
        stars.forEach(star => {
            star.addEventListener('click', function() {
                currentRating = parseInt(this.getAttribute('data-rating'));
                updateStars(productId, currentRating);
            });
        });
    }

    function updateStars(productId, rating) {
        const stars = document.querySelectorAll(`#stars-${productId} .star`);
        stars.forEach((star, index) => {
            star.style.color = index < rating ? '#ffc107' : '#ccc';
        });
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ============== //
    async function loadRatings(productId) {
        const ratingsList = document.getElementById(`ratings-list-${productId}`);
        if (!ratingsList) return;

        ratingsList.innerHTML = '<div class="loading-riating">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...</div>';

        try {
            const snapshot = await database.ref(`ratings/${productId}`).orderByChild('date').once('value');
            const ratings = snapshot.val() || {};
            
            ratingsList.innerHTML = "";
            
            if (Object.keys(ratings).length === 0) {
                ratingsList.innerHTML = '<div class="no-ratings">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ‚ÙŠÙ…!</div>';
                return;
            }

            let totalRating = 0;
            let count = 0;

            for (const [ratingId, rating] of Object.entries(ratings)) {
                if (rating.status === 'active') {
                    totalRating += rating.rating;
                    count++;
                    
                    const ratingItem = createRatingItem(productId, ratingId, rating);
                    ratingsList.appendChild(ratingItem);
                    
                    await loadVotesForRating(productId, ratingId);
                }
            }

            updateAverageRating(productId, totalRating, count);
        } catch (error) {
            console.error("Error loading ratings:", error);
            ratingsList.innerHTML = `
                <div class="error-msg">
                    Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                    <button onclick="loadRatings('${productId}')">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                </div>
            `;
        }
    }

    async function loadVotesForRating(productId, ratingId) {
        try {
            const snapshot = await database.ref(`votes/${productId}/${ratingId}`).once('value');
            const votes = snapshot.val() || {};
            
            let helpful = 0, notHelpful = 0;
            Object.values(votes).forEach(vote => {
                vote.vote ? helpful++ : notHelpful++;
            });
            
            updateVoteUI(productId, ratingId, helpful, notHelpful);
        } catch (error) {
            console.error("Error loading votes:", error);
        }
    }

    function createRatingItem(productId, ratingId, rating) {
        const ratingItem = document.createElement('div');
        ratingItem.className = 'rating-item';
        ratingItem.id = `rating-${ratingId}`;
        ratingItem.innerHTML = `
            <div class="rating-header">
                <strong class="rating-username">${sanitizeHtml(rating.username)}</strong>
                <div class="rating-stars">${generateStars(rating.rating)}</div>
            </div>
            <p class="rating-comment">${sanitizeHtml(rating.comment)}</p>
            <small class="rating-date">${formatDate(rating.date)}</small>
            
            <div class="vote-actions">
                <button onclick="voteHelpful(true, '${ratingId}', '${productId}')" 
                        class="helpful-btn" id="helpful-btn-${productId}-${ratingId}">
                    ğŸ‘ Ù…ÙÙŠØ¯ (<span id="helpful-count-${productId}-${ratingId}">0</span>)
                </button>
                <button onclick="voteHelpful(false, '${ratingId}', '${productId}')" 
                        class="not-helpful-btn" id="not-helpful-btn-${productId}-${ratingId}">
                    ğŸ‘ ØºÙŠØ± Ù…ÙÙŠØ¯ (<span id="not-helpful-count-${productId}-${ratingId}">0</span>)
                </button>        
            </div>
            <div class="report-section">
                <select id="report-reason-${ratingId}" class="report-reason">
                    <option value="spam">Ù…Ø­ØªÙˆÙ‰ Ù…Ø²Ø¹Ø¬</option>
                    <option value="abuse">Ø¥Ø³Ø§Ø¡Ø©</option>
                    <option value="wrong">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§Ø·Ø¦Ø©</option>
                </select>
                <button class="report-btn" onclick="reportRating('${productId}', '${ratingId}')">
                    Ø¥Ø¨Ù„Ø§Øº
                </button>
            </div>
        `;
        return ratingItem;
    }

    async function submitRating(productId) {
    const submitBtn = document.querySelector(`button[onclick="submitRating('${productId}')"]`);
    if (!submitBtn) {
        console.error('Submit button not found');
        return;
    }

    const originalText = submitBtn.textContent;
    const errorEl = document.getElementById(`error-message-${productId}`);
    const usernameEl = document.getElementById(`username-${productId}`);
    const commentEl = document.getElementById(`comment-${productId}`);

    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        if (!errorEl || !usernameEl || !commentEl) {
            const missingElements = [];
            if (!errorEl) missingElements.push(`error-message-${productId}`);
            if (!usernameEl) missingElements.push(`username-${productId}`);
            if (!commentEl) missingElements.push(`comment-${productId}`);
            console.error('Missing elements:', missingElements.join(', '));
            return;
        }

        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...';
        submitBtn.disabled = true;

        // Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Ø³Ø§Ø¨Ù‚Ø©
        hideErrorMessages(productId);

        // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
        resetInvalidFields(productId);

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const username = usernameEl.value.trim();
        const comment = commentEl.value.trim();

        if (!username || username.length < 3) {
            showErrorMessage(productId, "name", "Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
            usernameEl.classList.add('invalid');
            usernameEl.focus(); // Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØªØ±ÙƒÙŠØ² Ù„Ù„Ø­Ù‚Ù„ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­
            throw new Error("Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
        }

        if (!comment || comment.length < 10) {
            showErrorMessage(productId, "comment", "Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
            commentEl.classList.add('invalid');
            commentEl.focus();
            throw new Error("Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
        }

        if (currentRating < 1 || currentRating > 5) {
            showErrorMessage(productId, "rating", "Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 5 Ù†Ø¬ÙˆÙ…");
            throw new Error("Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 5 Ù†Ø¬ÙˆÙ…");
        }

        // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ù‡Ù†Ø§ØŒ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©
        // ... Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙÙŠ Firebase ...

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        const successEl = document.getElementById(`success-message-${productId}`);
        if (successEl) {
            successEl.textContent = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!";
            successEl.style.display = 'block';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                successEl.style.display = 'none';
            }, 5000);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        usernameEl.value = "";
        commentEl.value = "";
        currentRating = 0;
        updateStars(productId, 0);

    } catch (error) {
        console.error("Error details:", error);
        // Ù„Ø§ Ø¯Ø§Ø¹ÙŠ Ù„Ù€ showAlert Ù‡Ù†Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø®ØµØµØ©
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}

// Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:

function hideErrorMessages(productId) {
    const errorEl = document.getElementById(`error-message-${productId}`);
    if (errorEl) {
        errorEl.style.display = 'none';
    }
}

function resetInvalidFields(productId) {
    const usernameEl = document.getElementById(`username-${productId}`);
    const commentEl = document.getElementById(`comment-${productId}`);
    
    usernameEl?.classList.remove('invalid');
    commentEl?.classList.remove('invalid');
}

function showErrorMessage(productId, errorType, message) {
    const errorEl = document.getElementById(`error-message-${productId}`);
    if (!errorEl) return;

    errorEl.textContent = message;
    errorEl.className = `error-message ${errorType}-error`;
    errorEl.style.display = 'block';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
    setTimeout(() => {
        errorEl.classList.add('fade-out');
        setTimeout(() => {
            errorEl.style.display = 'none';
            errorEl.classList.remove('fade-out');
        }, 500);
    }, 5000);
}

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙˆÙŠØª ============== //
   async function voteHelpful(isHelpful, ratingId, productId) {
    if (isVoting) return;
    isVoting = true;

    try {
        const user = auth.currentUser;
        if (!user) {
            showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }

        const helpfulBtn = document.getElementById(`helpful-btn-${productId}-${ratingId}`);
        const notHelpfulBtn = document.getElementById(`not-helpful-btn-${productId}-${ratingId}`);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        helpfulBtn.disabled = true;
        notHelpfulBtn.disabled = true;
        
        const voteRef = database.ref(`votes/${productId}/${ratingId}/${user.uid}`);
        const snapshot = await voteRef.once('value');
        const previousVote = snapshot.exists() ? snapshot.val().vote : null;
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø«Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª)
        if (previousVote === isHelpful) {
            await voteRef.remove();
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            helpfulBtn.classList.remove('active');
            notHelpfulBtn.classList.remove('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
            updateVoteCount(productId, ratingId, isHelpful ? -1 : 0, isHelpful ? 0 : -1);
        } 
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØµÙˆÙŠØª Ù…Ø®ØªÙ„Ù (ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙˆÙŠØª)
        else if (previousVote !== null) {
            await voteRef.set({
                vote: isHelpful,
                timestamp: Date.now(),
                userId: user.uid
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            if (isHelpful) {
                helpfulBtn.classList.add('active');
                notHelpfulBtn.classList.remove('active');
            } else {
                helpfulBtn.classList.remove('active');
                notHelpfulBtn.classList.add('active');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
            updateVoteCount(productId, ratingId, isHelpful ? 1 : -1, isHelpful ? -1 : 1);
        }
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØµÙˆÙŠØª Ø¬Ø¯ÙŠØ¯
        else {
            await voteRef.set({
                vote: isHelpful,
                timestamp: Date.now(),
                userId: user.uid
            });
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            if (isHelpful) {
                helpfulBtn.classList.add('active');
            } else {
                notHelpfulBtn.classList.add('active');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
            updateVoteCount(productId, ratingId, isHelpful ? 1 : 0, isHelpful ? 0 : 1);
        }
        
    } catch (error) {
        console.error("Error in voting:", error);
        showAlert(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`, 'error');
    } finally {
        isVoting = false;
        const helpfulBtn = document.getElementById(`helpful-btn-${productId}-${ratingId}`);
        const notHelpfulBtn = document.getElementById(`not-helpful-btn-${productId}-${ratingId}`);
        if (helpfulBtn) helpfulBtn.disabled = false;
        if (notHelpfulBtn) notHelpfulBtn.disabled = false;
    }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
function updateVoteCount(productId, ratingId, deltaHelpful, deltaNotHelpful) {
    const helpfulElement = document.getElementById(`helpful-count-${productId}-${ratingId}`);
    const notHelpfulElement = document.getElementById(`not-helpful-count-${productId}-${ratingId}`);

    if (helpfulElement) {
        const current = parseInt(helpfulElement.textContent) || 0;
        helpfulElement.textContent = Math.max(0, current + deltaHelpful);
    }

    if (notHelpfulElement) {
        const current = parseInt(notHelpfulElement.textContent) || 0;
        notHelpfulElement.textContent = Math.max(0, current + deltaNotHelpful);
    }
}    
    function updateVoteUI(productId, ratingId, helpful, notHelpful) {
        const helpfulElement = document.getElementById(`helpful-count-${productId}-${ratingId}`);
        const notHelpfulElement = document.getElementById(`not-helpful-count-${productId}-${ratingId}`);

        if (helpfulElement) {
            helpfulElement.textContent = helpful;
        }

        if (notHelpfulElement) {
            notHelpfulElement.textContent = notHelpful;
        }
    }

    function updateCountersUI(productId, ratingId, deltaHelpful, deltaNotHelpful, currentVote) {
        const helpfulElement = document.getElementById(`helpful-count-${productId}-${ratingId}`);
        const notHelpfulElement = document.getElementById(`not-helpful-count-${productId}-${ratingId}`);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹Ø¯Ø§Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©
        if (helpfulElement) {
            const currentHelpful = parseInt(helpfulElement.textContent) || 0;
            helpfulElement.textContent = currentHelpful + deltaHelpful;
        }

        if (notHelpfulElement) {
            const currentNotHelpful = parseInt(notHelpfulElement.textContent) || 0;
            notHelpfulElement.textContent = currentNotHelpful + deltaNotHelpful;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙˆÙŠØª
        updateButtonStates(productId, ratingId, currentVote);
    }

    function updateButtonStates(productId, ratingId, currentVote) {
        const helpfulBtn = document.getElementById(`helpful-btn-${productId}-${ratingId}`);
        const notHelpfulBtn = document.getElementById(`not-helpful-btn-${productId}-${ratingId}`);

        if (helpfulBtn) helpfulBtn.classList.remove('active');
        if (notHelpfulBtn) notHelpfulBtn.classList.remove('active');

        if (currentVote === true && helpfulBtn) {
            helpfulBtn.classList.add('active');
        } else if (currentVote === false && notHelpfulBtn) {
            notHelpfulBtn.classList.add('active');
        }
    }

    function showLoading(show, productId, ratingId) {
        const loader = document.getElementById(`vote-loader-${productId}-${ratingId}`);
        if (loader) {
            loader.style.display = show ? 'block' : 'none';
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ============== //
    async function reportRating(productId, ratingId) {
        try {
            const user = auth.currentUser;
            if (!user) throw new Error("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");

            const reasonSelect = document.getElementById(`report-reason-${ratingId}`);
            const reason = reasonSelect ? reasonSelect.value : "other";
            const reasonText = getReasonText(reason);
            
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ\nØ§Ù„Ø³Ø¨Ø¨: ${reasonText}`)) {
                return;
            }

            const reportData = {
                productId: productId,
                ratingId: ratingId,
                reason: reason,
                date: new Date().toISOString(),
                status: "pending",
                reportedBy: user.uid
            };

            await database.ref(`reports/${Date.now()}`).set(reportData);
            
            markAsReported(ratingId);
            showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨Ù„Ø§ØºÙƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡', 'success');
            
        } catch (error) {
            console.error("Error saving report:", error);
            showAlert(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`, 'error');
        }
    }

    // ============== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ============== //
    function checkAdminAccess() {
        const urlParams = new URLSearchParams(window.location.search);
        const adminKey = urlParams.get('admin');
        
        if (adminKey === ADMIN_PASSWORD) {
            showAdminPanel();
            loadReports();
        }
    }

    async function loadReports() {
        try {
            const reportsList = document.getElementById('reports-list');
            if (!reportsList) return;
            
            reportsList.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª...</div>';

            const snapshot = await database.ref('reports').orderByChild('status').equalTo('pending').once('value');
            const reports = snapshot.val() || {};
            
            reportsList.innerHTML = "";
            
            if (Object.keys(reports).length === 0) {
                reportsList.innerHTML = '<p class="no-reports">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>';
                return;
            }

            for (const [reportId, report] of Object.entries(reports)) {
                const reportItem = createReportItem(reportId, report);
                reportsList.appendChild(reportItem);
            }
        } catch (error) {
            console.error("Error loading reports:", error);
            const reportsList = document.getElementById('reports-list');
            if (reportsList) {
                reportsList.innerHTML = '<div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</div>';
            }
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© ============== //
    let cart = [];

    function loadCart() {
        const savedCart = localStorage.getItem('cart');
        if (savedCart) {
            cart = JSON.parse(savedCart);
            updateCartUI();
        }
    }

    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
    }

    function updateCartUI() {
        const cartItemsList = document.getElementById('cart-items');
        const cartCountElement = document.getElementById('cart-count');
        const totalPriceElement = document.getElementById('total-price');
        
        cartItemsList.innerHTML = '';
        
        if (cart.length === 0) {
            document.getElementById('empty-cart-message').style.display = 'block';
            document.getElementById('empty-cart-message').textContent = 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©';
        } else {
            document.getElementById('empty-cart-message').style.display = 'none';
            
            let total = 0;
            
            cart.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${item.name} - ${item.quantity} Ã— ${item.price} Ø¬Ù†ÙŠÙ‡ 
                    <button onclick="removeFromCart(${index})" class="remove-item">Ã—</button>
                `;
                cartItemsList.appendChild(li);
                total += item.price * item.quantity;
            });
            
            totalPriceElement.textContent = total;
        }
        
        cartCountElement.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    function addToCartAndShow(button) {
        addToCart(button);
        toggleCartPopup();
    }

    function addToCart(button) {
        const quantity = parseInt(document.getElementById('quantity').value);
        const name = button.dataset.name;
        const price = parseInt(button.dataset.price);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        const existingItemIndex = cart.findIndex(item => item.name === name);
        
        if (existingItemIndex >= 0) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            cart[existingItemIndex].quantity += quantity;
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
            cart.push({
                name: name,
                price: price,
                quantity: quantity
            });
        }
        
        saveCart();
        showAlert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©', 'success');
    }

    function removeFromCart(index) {
        if (index >= 0 && index < cart.length) {
            cart.splice(index, 1);
            saveCart();
        }
    }

    function confirmClearCart() {
        if (cart.length === 0) return;
        
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©ØŸ')) {
            clearCart();
        }
    }

    function clearCart() {
        cart = [];
        saveCart();
        showAlert('ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©', 'success');
    }

    function toggleCartPopup() {
        const cartPopup = document.getElementById('cart-popup');
        const overlay = document.getElementById('overlay');
        
        if (cartPopup.classList.contains('hidden')) {
            cartPopup.classList.remove('hidden');
            overlay.classList.remove('hidden');
        } else {
            cartPopup.classList.add('hidden');
            overlay.classList.add('hidden');
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª ============== //
    function checkout() {
        if (cart.length === 0) {
            showAlert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }
        
        const checkoutForm = document.getElementById('checkout-form');
        const cartPopup = document.getElementById('cart-popup');
        
        cartPopup.classList.add('hidden');
        checkoutForm.classList.remove('hidden');
    }

    function closeCheckout() {
        document.getElementById('checkout-form').classList.add('hidden');
        document.getElementById('overlay').classList.add('hidden');
    }

    function togglePaymentInfo() {
        const paymentMethod = document.getElementById('payment-method').value;
        const fawryInfo = document.getElementById('fawry-info');
        
        if (paymentMethod === 'fawry') {
            fawryInfo.classList.remove('hidden');
        } else {
            fawryInfo.classList.add('hidden');
        }
    }

    async function submitOrder() {
        const name = document.getElementById('customer-name').value.trim();
        const phone = document.getElementById('customer-phone').value.trim();
        const whatsapp = document.getElementById('customer-whatsapp').value.trim();
        const address = document.getElementById('customer-address').value.trim();
        const paymentMethod = document.getElementById('payment-method').value;
        const termsChecked = document.getElementById('terms-checkbox').checked;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!name || !phone || !whatsapp || !address) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
            return;
        }
        
        if (!termsChecked) {
            showAlert('ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…', 'error');
            return;
        }
        
        // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
        const order = {
            customer: { name, phone, whatsapp, address },
            paymentMethod,
            items: [...cart],
            total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
            date: new Date().toISOString(),
            status: 'pending'
        };
        
        try {
            // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const ordersRef = database.ref('orders');
            await ordersRef.push(order);
            
            // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
            clearCart();
            closeCheckout();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('checkout-form').reset();
            document.getElementById('fawry-info').classList.add('hidden');
            
            showAlert('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'success');
        } catch (error) {
            console.error('Error submitting order:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
        }
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ============== //
    function openTermsPopup() {
        document.getElementById('terms-popup').classList.remove('hidden');
        document.getElementById('overlay').classList.remove('hidden');
    }

    function closeTermsPopup() {
        document.getElementById('terms-popup').classList.add('hidden');
        document.getElementById('overlay').classList.add('hidden');
    }

    // ============== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ============== //
    function generateStars(rating) {
        let stars = "";
        for (let i = 1; i <= 5; i++) {
            stars += i <= rating ? 'â˜…' : 'â˜†';
        }
        return stars;
    }

    function updateAverageRating(productId, totalRating, count) {
        const average = count > 0 ? (totalRating / count).toFixed(1) : 0;
        const averageElement = document.getElementById(`average-rating-${productId}`);
        if (averageElement) {
            averageElement.innerHTML = `Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${generateStars(Math.round(average))} <span class="average-number">(${average} Ù…Ù† 5)</span>`;
        }
    }

    function formatDate(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleString('ar-EG');
        } catch (e) {
            return dateString;
        }
    }

    function getReasonText(reason) {
        const reasons = {
            'spam': 'Ù…Ø­ØªÙˆÙ‰ Ù…Ø²Ø¹Ø¬',
            'abuse': 'Ø¥Ø³Ø§Ø¡Ø©',
            'wrong': 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§Ø·Ø¦Ø©',
            'other': 'Ø£Ø³Ø¨Ø§Ø¨ Ø£Ø®Ø±Ù‰'
        };
        return reasons[reason] || reason;
    }

    function markAsReported(ratingId) {
        const ratingElement = document.getElementById(`rating-${ratingId}`);
        if (ratingElement) {
            ratingElement.classList.add('reported');
        }
    }

    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        document.body.appendChild(alertDiv);
        
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }

    function sanitizeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.getElementById('overlay').addEventListener('click', function() {
        document.getElementById('cart-popup').classList.add('hidden');
        document.getElementById('checkout-form').classList.add('hidden');
        document.getElementById('terms-popup').classList.add('hidden');
        this.classList.add('hidden');
    });
    </script>
</body>
</html>